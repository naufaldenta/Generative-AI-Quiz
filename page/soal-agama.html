<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Agama Islam | Generative AI</title>
    <link rel="stylesheet" href="../src/output.css">
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-4">Quiz Agama Islam</h1>
            <p class="text-gray-600 dark:text-gray-300">Generated by AI for interactive learning</p>
        </header>

        <div class="max-w-3xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-4">
                    <span class="text-gray-700 dark:text-gray-300">Time: <span id="timer" class="font-mono">00:00</span></span>
                    <span class="text-gray-700 dark:text-gray-300">Score: <span id="score" class="font-mono">0/4</span></span>
                </div>
            </div>

            <div id="questionsContainer" class="space-y-6">
                <!-- Questions will be dynamically inserted here -->
            </div>

            <div class="mt-6 flex justify-between">
                <button id="submitQuiz" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    Submit Quiz
                </button>
                <button id="backToHome" onclick="window.location.href='../index.html'" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                    Back to Home
                </button>
            </div>

            <div id="results" class="hidden mt-8 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Quiz Results</h2>
                <div class="space-y-4">
                    <p class="text-gray-600 dark:text-gray-300">Correct Answers: <span id="correctAnswers">0</span>/4</p>
                    <p class="text-gray-600 dark:text-gray-300">Time Taken: <span id="timeTaken">00:00</span></p>
                </div>
                <button id="retryQuiz" onclick="location.reload()" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    Try Again
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const questionsContainer = document.getElementById('questionsContainer');
            const submitButton = document.getElementById('submitQuiz');
            const resultsDiv = document.getElementById('results');
            const timerElement = document.getElementById('timer');
            const scoreElement = document.getElementById('score');
            
            let startTime = Date.now();
            let timer = setInterval(updateTimer, 1000);
            
            function updateTimer() {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                timerElement.textContent = `${minutes}:${seconds}`;
            }

            function extractQuestionText(text) {
                const match = text.match(/\*\*Soal \d+:\*\*(.*?)(?=\s*[A-E]\.|\s*\*\*|$)/s);
                return match ? match[1].trim() : '';
            }

            function parseQuizData(rawData) {
                const questions = [];
                const questionBlocks = rawData.split(/\*\*Soal \d+:\*\*/g).filter(Boolean);

                questionBlocks.forEach((block) => {
                    const lines = block.trim().split('\n');
                    const questionText = lines[0].trim();
                    const options = [];
                    let correct = '';

                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine.match(/^[A-E]\./)) {
                            options.push(trimmedLine);
                        } else if (trimmedLine.includes('**Jawaban:**')) {
                            correct = trimmedLine.match(/[A-E]/)[0];
                        }
                    });

                    if (questionText && options.length > 0) {
                        questions.push({
                            text: questionText,
                            options: options,
                            correct: correct
                        });
                    }
                });

                return questions;
            }

            function renderQuestions(questions) {
                questions.forEach((question, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6';
                    
                    questionDiv.innerHTML = `
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                            ${index + 1}. ${question.text}
                        </h3>
                        <div class="space-y-3">
                            ${question.options.map((option, optIndex) => `
                                <label class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                    <input type="radio" name="question${index}" value="${option.charAt(0)}" 
                                           class="form-radio h-5 w-5 text-blue-600">
                                    <span class="text-gray-700 dark:text-gray-300">${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    `;
                    
                    questionsContainer.appendChild(questionDiv);
                });
            }

            // Load and render quiz
            const quizData = JSON.parse(localStorage.getItem('quizData'));
            if (quizData && quizData.data) {
                const questions = parseQuizData(quizData.data);
                renderQuestions(questions);
            }

            // Handle quiz submission
            submitButton.addEventListener('click', () => {
                clearInterval(timer);
                const questions = parseQuizData(quizData.data);
                let correct = 0;
                
                questions.forEach((question, index) => {
                    const selected = document.querySelector(`input[name="question${index}"]:checked`);
                    if (selected && selected.value === question.correct) correct++;
                });

                scoreElement.textContent = `${correct}/4`;
                document.getElementById('correctAnswers').textContent = correct;
                document.getElementById('timeTaken').textContent = timerElement.textContent;
                
                resultsDiv.classList.remove('hidden');
                submitButton.disabled = true;
            });
        });
    </script>
</body>
</html>
